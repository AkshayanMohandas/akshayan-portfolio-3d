<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-174941093-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-174941093-1');
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-P437XK4');</script>
      <!-- End Google Tag Manager -->

      <link rel="icon" href="favicon.ico" />
    <link rel="alternate" type="application/json+oembed" href="%PUBLIC_URL%/website-screenshot.png"/>
    <meta property="og:title" content="Akshayan Mohandas - 3D Portfolio" />
    <meta property="og:description" content="Akshayan Mohandas - Interactive 3D Portfolio Website"/>
    <meta property="og:url" content="akshayan-portfolio-3d" />
    <meta name="image" property="og:image" content="website-screenshot.png"/>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Audiowide&display=swap" rel="stylesheet">
    <!-- Additional candidate fonts for the name title -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Michroma&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>Akshayan Mohandas - 3D Portfolio</title>
  </head>
  <body id="document-body">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P437XK4"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <!-- End Google Tag Manager (noscript) -->
    <div id="WEBGLcontainer"></div>
    <div id="joystick-wrapper"></div>
     <div class="fadeOutDiv preload-overlay" id="preload-overlay">
      <!-- Animated star layers -->
      <div class="star-field"></div>
      <div class="star-field"></div>
      <div class="star-field"></div>
      
      <!-- Spaceman image overlay -->
      <img src="/src/jsm/spaceman.png" alt="Spaceman" class="spaceman-overlay" />
      
      <div class="start-page-content-div fadeOutDiv">
        <div id="name-display" class="postload fadeOutDiv"></div>
        <div id="name-display-front" class="postload fadeOutDiv"></div>
        <button id="start-button" class="postload fadeOutDiv">Enter Orbit</button>
      </div>
      <div class="trinity-rings-spinner preload">
        <div class="circle preload"></div>
        <div class="circle preload"></div>
        <div class="circle preload"></div>
      </div>
    <div class="loading-text-div preload">Loading<span class="loader__dot">.</span><span class="loader__dot">.</span><span class="loader__dot">.</span></div>
    <div id="tooltip"></div>
    <script type="x-shader/x-vertex" id="vertexShader">

      varying vec3 vWorldPosition;

      void main() {

      	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
      	vWorldPosition = worldPosition.xyz;

      	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
    </script>

    <script type="x-shader/x-fragment" id="fragmentShader">

      uniform vec3 topColor;
      uniform vec3 bottomColor;
      uniform float offset;
      uniform float exponent;

      varying vec3 vWorldPosition;

      void main() {

      	float h = normalize( vWorldPosition + offset ).y;
      	gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );

      }
    </script>

    <script src="build/app.bundle.js"></script>
    <script>
      (function() {
        const nameEl = document.getElementById('name-display');
        const nameElFront = document.getElementById('name-display-front');
        if (!nameEl || !nameElFront) return;

        const TARGET_HTML = 'AKSHAYAN<br>MOHANDAS';
        const LETTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const TOTAL_DURATION_MS = 2000; // increased animation time for smoother effect
        const FPS = 60; // reduced FPS to prevent lag during loading

        function tokenize(html) {
          // Convert to tokens: {type: 'br'|'space'|'char', char?}
          const tokens = [];
          const parts = html.split(/(<br\s*\/?>)/i);
          for (const part of parts) {
            if (!part) continue;
            if (/^<br\s*\/?>$/i.test(part)) {
              tokens.push({ type: 'br' });
            } else {
              for (const ch of part) {
                if (ch === ' ') tokens.push({ type: 'space', char: ' ' });
                else tokens.push({ type: 'char', char: ch });
              }
            }
          }
          return tokens;
        }

        function render(tokens, fixedFlags, element) {
          let out = '';
          let charIndex = 0;
          for (const t of tokens) {
            if (t.type === 'br') { out += '<br>'; continue; }
            if (t.type === 'space') { out += ' '; continue; }
            // type === 'char'
            if (fixedFlags[charIndex]) out += t.char;
            else out += LETTERS[(Math.random() * LETTERS.length) | 0];
            charIndex++;
          }
          element.innerHTML = out;
        }

        function animateTo(targetHtml, durationMs) {
          const tokens = tokenize(targetHtml);
          const charPositions = tokens
            .map((t, i) => ({ t, i }))
            .filter(x => x.t.type === 'char')
            .map((_x, idx) => idx);

          // Shuffle settle order for more organic effect
          for (let i = charPositions.length - 1; i > 0; i--) {
            const j = (Math.random() * (i + 1)) | 0;
            [charPositions[i], charPositions[j]] = [charPositions[j], charPositions[i]];
          }

          const fixedFlags = new Array(charPositions.length).fill(false);
          const start = performance.now();
          const interval = 1000 / FPS;
          let lastTick = start;

          function step(now) {
            if (now - lastTick >= interval) {
              lastTick = now;
              const elapsed = now - start;
              const progress = Math.min(1, elapsed / durationMs);
              const shouldBeFixed = Math.floor(progress * charPositions.length);
              for (let k = 0; k < shouldBeFixed; k++) fixedFlags[charPositions[k]] = true;
              render(tokens, fixedFlags, nameEl);
              render(tokens, fixedFlags, nameElFront);
            }
            if (fixedFlags.some(v => !v)) requestAnimationFrame(step);
            else {
              // Only set final text after animation completes
              nameEl.innerHTML = targetHtml;
              nameElFront.innerHTML = targetHtml;
            }
          }

          // Initialize with all random letters immediately
          render(tokens, fixedFlags, nameEl);
          render(tokens, fixedFlags, nameElFront);
          requestAnimationFrame(step);
        }

        // Wait for 3D scene to load before starting animation
        function waitForSceneLoad() {
          // Check if the 3D scene is ready
          if (window.sceneLoadingComplete) {
            // Start animation after scene is fully loaded
            setTimeout(() => animateTo(TARGET_HTML, TOTAL_DURATION_MS), 1000);
          } else {
            // Keep checking until 3D scene is ready
            setTimeout(waitForSceneLoad, 500);
          }
        }

        // Trigger animation after 3D scene is ready
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
          waitForSceneLoad();
        } else {
          document.addEventListener('DOMContentLoaded', waitForSceneLoad);
        }
      })();
    </script>
  </body>
</html>
